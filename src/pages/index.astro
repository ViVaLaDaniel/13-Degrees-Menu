---
import Layout from "../layouts/Layout.astro";
import MenuCard from "../components/MenuCard.astro";
import { dishData } from "../data/dishes";

const dishes = Object.entries(dishData).map(([key, dish]) => ({ key, dish }));
---

<Layout title="13 DEGREES | BLUEFIN MENU ARCHITECTURE">
  <!-- Language Switcher -->
  <div class="lang-switch">
    <button class="lang-btn active" data-lang="en">EN</button>
    <span class="sep">|</span>
    <button class="lang-btn" data-lang="es">ES</button>
    <span class="sep">|</span>
    <button class="lang-btn" data-lang="ru">RU</button>
  </div>

  <header class="hero">
    <div class="hero-overlay"></div>

    <div class="hero-content">
      <span class="eyebrow" data-i18n="hero_eyebrow">Exclusive Presentation</span>
      <h1 data-i18n="hero_title">13 Degrees: <br /><span class="highlight">The Exclusive Collections</span></h1>
      <p data-i18n="hero_desc">Smart Luxury Concept: High-end gastronomy with zero kitchen stress.</p>
      <a href="#menu" class="btn-primary" data-i18n="hero_btn">Explore the Menu</a>
    </div>
  </header>

  <section class="intro">
    <div class="container">
      <div class="intro-grid">
        <div class="intro-text">
          <h2 data-i18n="intro_title">The Concept: <br />‚ÄúRaw, Rare & Crispy‚Äù</h2>
          <p data-i18n="intro_desc">
            We combine the prestige of Bluefin Tuna with high-precision technology (Sous-Vide, Aburi, Slicing) to deliver Michelin-level quality without the need for a full stovetop kitchen.
          </p>
        </div>
        <div class="intro-features">
          <div class="feature-item">
            <span class="feature-icon">‚ú®</span>
            <h3 data-i18n="feat_vip_title">VIP Aesthetics</h3>
            <p data-i18n="feat_vip_desc">Plating designed for the Balearic/Estepona upscale lifestyle.</p>
          </div>
          <div class="feature-item">
            <span class="feature-icon">‚ö°</span>
            <h3 data-i18n="feat_ops_title">Smart Ops</h3>
            <p data-i18n="feat_ops_desc">90% prep, 10% service. No stress for the chef during peak hours.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section id="menu" class="menu-section">
    <div class="container">
      <div class="section-title">
        <h2 data-i18n="menu_title">NORDIC & ASIAN FUSION: SALMON</h2>
        <p data-i18n="menu_desc">High gastronomy in every bite. Textures, temperatures, and perfect balance with white wines.</p>
      </div>

      <!-- Category Switcher -->
      <div class="menu-grid">
        {dishes.map(({ key, dish }) => <MenuCard id={key} dish={dish} />)}
      </div>
    </div>
  </section>

  <!-- Professional Modal for Kitchen Technical Cards -->
  <div id="modal" class="modal">
    <div class="modal-backdrop"></div>
    <div class="modal-container">
      <button class="modal-close">&times;</button>

      <div class="modal-content">
        <!-- Image Container (Shrinks and slides up) -->
        <div class="modal-image-box">
          <img id="modal-img" src="" alt="" />

          <button class="btn-info-trigger" data-i18n="btn_info">INFO & TECHNICAL SHEET</button>
          <button class="btn-close-sheet" data-i18n="btn_image">VIEW IMAGE ONLY</button>
        </div>

        <!-- Technical Card (Slides up from below) -->
        <div class="modal-tech-card">
          <div class="ficha-header">
            <span class="ficha-label" data-i18n="modal_label">KITCHEN TECHNICAL SHEET</span>
            <h2 id="modal-title"></h2>
            <div class="ficha-meta">
              <span><strong data-i18n="modal_servings">Servings:</strong> 1 person</span>
              <span><strong data-i18n="modal_prep">Prep Time:</strong> &lt; 5 min</span>
            </div>
          </div>

          <div class="ficha-body">
            <div class="ficha-column">
              <h3><span class="icon">ü•ó</span> <span data-i18n="modal_ingredients">INGREDIENTS</span></h3>
              <ul id="modal-ingredients" class="kitchen-list"></ul>
            </div>
            <div class="ficha-column">
              <h3><span class="icon">üç≥</span> <span data-i18n="modal_prep_title">PREPARATION</span></h3>
              <div class="sauce-block">
                <h4 data-i18n="modal_sauce_label">Sauce & Base:</h4>
                <p id="modal-sauce"></p>
              </div>
              <ol id="modal-steps" class="kitchen-steps"></ol>
            </div>
          </div>

          <div class="ficha-equipment">
            <h3><span class="icon">üõ†Ô∏è</span> <span data-i18n="modal_equipment">EQUIPMENT</span></h3>
            <p id="modal-equi"></p>
          </div>

          <div class="ficha-footer">
            <div class="cost-item">
              <span class="label" data-i18n="modal_cost_label">FOOD COST (MATERIA PRIMA)</span>
              <span id="modal-cost" class="value"></span>
            </div>
            <div class="cost-item">
              <span class="label" data-i18n="modal_pvp_label">PVP (PRECIO VENTA)</span>
              <span id="modal-pvp" class="value highlight"></span>
            </div>
            <div class="cost-item highlight-box">
              <span class="label" data-i18n="modal_margin_label">PROFIT MARGIN</span>
              <span id="modal-margin" class="value profit"></span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Atmosphere & Lifestyle Section -->
  <section class="atmosphere">
    <div class="parallax-bg" style="background-image: url('/assets/Facebook/471294467_122130011582572577_8444876307954081098_n.jpg');"></div>
    <div class="atmosphere-overlay"></div>
    <div class="container relative">
      <div class="section-title">
        <span class="eyebrow" data-i18n="vibe_eyebrow">The Vibe</span>
        <h2 data-i18n="vibe_title">More Than Just Food</h2>
        <p data-i18n="vibe_desc">13 Degrees is where Estepona‚Äôs soul meets high-end mixology and vibrant social life.</p>
      </div>

      <div class="lifestyle-grid">
        <div class="lifestyle-item reveal">
          <img src="/assets/Facebook/471170183_122128362296572577_6777743808295086014_n.jpg" alt="Vibe 1" loading="lazy" decoding="async" />
        </div>
        <div class="lifestyle-item reveal">
          <img src="/assets/Facebook/471200641_122130011354572577_5012237729507196814_n.jpg" alt="Vibe 2" loading="lazy" decoding="async" />
        </div>
        <div class="lifestyle-item reveal">
          <img src="/assets/Facebook/Boss_n.jpg" alt="Vibe 3" loading="lazy" decoding="async" />
        </div>
        <div class="lifestyle-item reveal">
          <img src="/assets/Facebook/470681455_122128164530572577_3967992789855390523_n.jpg" alt="Vibe 4" loading="lazy" decoding="async" />
        </div>
      </div>
    </div>
  </section>

  <!-- Final CTA Section -->
  <section class="cta-banner reveal">
    <div class="container text-center">
      <h2 data-i18n="cta_title">YOUR MENU COULD BE LIKE THIS TOMORROW</h2>
      <p data-i18n="cta_desc">We created a system where premium product (tuna & salmon) meets smart technology. No extra staff. No waste. Only taste and profit.</p>
      <a href="https://wa.me/48537617365" target="_blank" class="btn-primary" data-i18n="cta_btn">Discuss launch with Julia</a>
    </div>
  </section>

  <footer class="footer">
    <div class="container">
      <h2>13 DEGREES | LOUNGE BAR</h2>
      <p data-i18n="footer_text">Full project developed for 13 Degrees Lounge BAR.</p>
    </div>
  </footer>

  <script define:vars={{ dishData }}>
    // TRANSLATIONS DATA
    const translations = {
      en: {
        hero_eyebrow: "Exclusive Presentation",
        hero_title: "13 Degrees: <br /><span class='highlight'>The Exclusive Collections</span>",
        hero_desc: "Smart Luxury Concept: High-end gastronomy with zero kitchen stress.",
        hero_btn: "Explore the Menu",
        intro_title: "The Concept: <br />‚ÄúRaw, Rare & Crispy‚Äù",
        intro_desc:
          "We combine the prestige of Bluefin Tuna with high-precision technology (Sous-Vide, Aburi, Slicing) to deliver Michelin-level quality without the need for a full stovetop kitchen.",
        feat_vip_title: "VIP Aesthetics",
        feat_vip_desc: "Plating designed for the Balearic/Estepona upscale lifestyle.",
        feat_ops_title: "Smart Ops",
        feat_ops_desc: "90% prep, 10% service. No stress for the chef during peak hours.",
        menu_title: "NORDIC & ASIAN FUSION: SALMON",
        menu_desc: "High gastronomy in every bite. Textures, temperatures, and perfect balance with white wines.",
        btn_info: "INFO & TECHNICAL SHEET",
        btn_image: "VIEW IMAGE ONLY",
        modal_label: "KITCHEN TECHNICAL SHEET",
        modal_servings: "Servings:",
        modal_prep: "Prep Time:",
        modal_ingredients: "INGREDIENTS",
        modal_prep_title: "PREPARATION",
        modal_sauce_label: "Sauce & Base:",
        modal_equipment: "EQUIPMENT",
        modal_cost_label: "FOOD COST",
        modal_pvp_label: "PVP (SALE PRICE)",
        modal_margin_label: "PROFIT MARGIN",
        vibe_eyebrow: "The Vibe",
        vibe_title: "More Than Just Food",
        vibe_desc: "13 Degrees is where Estepona‚Äôs soul meets high-end mixology and vibrant social life.",
        cta_title: "YOUR MENU COULD BE LIKE THIS TOMORROW",
        cta_desc: "We created a system where premium product (tuna & salmon) meets smart technology. No extra staff. No waste. Only taste and profit.",
        cta_btn: "Discuss launch with Julia",
        footer_text: "Full project developed for 13 Degrees Lounge BAR.",
        view_details: "VIEW DETAILS",
        wine_pairing: "Wine Pairing:",
      },
      es: {
        hero_eyebrow: "Presentaci√≥n Exclusiva",
        hero_title: "13 Degrees: <br /><span class='highlight'>Las Colecciones Exclusivas</span>",
        hero_desc: "Concepto Smart Luxury: Gastronom√≠a de alta gama con cero estr√©s en cocina.",
        hero_btn: "Explorar el Men√∫",
        intro_title: "El Concepto: <br />‚ÄúRaw, Rare & Crispy‚Äù",
        intro_desc: "Combinamos el prestigio del At√∫n Rojo con tecnolog√≠a de alta precisi√≥n (Sous-Vide, Aburi, Corte) para ofrecer calidad Michelin sin necesidad de fogones.",
        feat_vip_title: "Est√©tica VIP",
        feat_vip_desc: "Emplatado dise√±ado para el estilo de vida exclusivo de Estepona/Baleares.",
        feat_ops_title: "Operativa Inteligente",
        feat_ops_desc: "90% prep, 10% servicio. Sin estr√©s para el chef en horas punta.",
        menu_title: "FUSI√ìN N√ìRDICA Y ASI√ÅTICA: SALM√ìN",
        menu_desc: "Alta gastronom√≠a en cada bocado. Texturas, temperaturas y equilibrio perfecto con vinos blancos.",
        btn_info: "INFO Y FICHA T√âCNICA",
        btn_image: "VER SOLO IMAGEN",
        modal_label: "FICHA T√âCNICA DE COCINA",
        modal_servings: "Raciones:",
        modal_prep: "Tiempo Prep:",
        modal_ingredients: "INGREDIENTES",
        modal_prep_title: "PREPARACI√ìN",
        modal_sauce_label: "Salsa y Base:",
        modal_equipment: "EQUIPAMIENTO",
        modal_cost_label: "COSTE MP",
        modal_pvp_label: "PVP (PRECIO VENTA)",
        modal_margin_label: "MARGEN BENEFICIO",
        vibe_eyebrow: "El Ambiente",
        vibe_title: "M√°s que solo comida",
        vibe_desc: "13 Degrees es donde el alma de Estepona se encuentra con la alta cocteler√≠a y la vida social vibrante.",
        cta_title: "TU MEN√ö PODR√çA SER AS√ç MA√ëANA",
        cta_desc: "Creamos un sistema donde el producto premium (at√∫n y salm√≥n) se une a la tecnolog√≠a inteligente. Sin personal extra. Sin mermas. Solo sabor y beneficio.",
        cta_btn: "Hablar del lanzamiento con Julia",
        footer_text: "Proyecto completo desarrollado para 13 Degrees Lounge BAR.",
        view_details: "VER DETALLES",
        wine_pairing: "Maridaje:",
      },
      ru: {
        hero_eyebrow: "–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω–∞—è –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è",
        hero_title: "13 Degrees: <br /><span class='highlight'>–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –ö–æ–ª–ª–µ–∫—Ü–∏–∏</span>",
        hero_desc: "–ö–æ–Ω—Ü–µ–ø—Ü–∏—è Smart Luxury: –í—ã—Å–æ–∫–∞—è –≥–∞—Å—Ç—Ä–æ–Ω–æ–º–∏—è –±–µ–∑ —Å—Ç—Ä–µ—Å—Å–∞ –Ω–∞ –∫—É—Ö–Ω–µ.",
        hero_btn: "–°–º–æ—Ç—Ä–µ—Ç—å –ú–µ–Ω—é",
        intro_title: "–ö–æ–Ω—Ü–µ–ø—Ü–∏—è: <br />‚ÄúRaw, Rare & Crispy‚Äù",
        intro_desc: "–ú—ã –æ–±—ä–µ–¥–∏–Ω—è–µ–º –ø—Ä–µ—Å—Ç–∏–∂ –ì–æ–ª—É–±–æ–≥–æ –¢—É–Ω—Ü–∞ —Å –≤—ã—Å–æ–∫–∏–º–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º–∏ (–°—É-–≤–∏–¥, –ê–±—É—Ä–∏, –ù–∞—Ä–µ–∑–∫–∞), —á—Ç–æ–±—ã –¥–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ —É—Ä–æ–≤–Ω—è Michelin –±–µ–∑ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π –≥–æ—Ä—è—á–µ–π –∫—É—Ö–Ω–∏.",
        feat_vip_title: "VIP –≠—Å—Ç–µ—Ç–∏–∫–∞",
        feat_vip_desc: "–ü–æ–¥–∞—á–∞, —Å–æ–∑–¥–∞–Ω–Ω–∞—è –¥–ª—è —Ä–æ—Å–∫–æ—à–Ω–æ–≥–æ —Å—Ç–∏–ª—è –∂–∏–∑–Ω–∏ –≠—Å—Ç–µ–ø–æ–Ω—ã –∏ –ë–∞–ª–µ–∞—Ä.",
        feat_ops_title: "–£–º–Ω–∞—è –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–∫–∞",
        feat_ops_desc: "90% –∑–∞–≥–æ—Ç–æ–≤–∫–∞, 10% —Å–µ—Ä–≤–∏—Å. –ù–∏–∫–∞–∫–æ–≥–æ —Å—Ç—Ä–µ—Å—Å–∞ –¥–ª—è —à–µ—Ñ–∞ –≤ —á–∞—Å –ø–∏–∫.",
        menu_title: "–°–ï–í–ï–†–´–ô –ò –ê–ó–ò–ê–¢–°–ö–ò–ô –§–¨–Æ–ñ–ù: –õ–û–°–û–°–¨",
        menu_desc: "–í—ã—Å–æ–∫–∞—è –≥–∞—Å—Ç—Ä–æ–Ω–æ–º–∏—è –≤ –∫–∞–∂–¥–æ–º –∫—É—Å–æ—á–∫–µ. –¢–µ–∫—Å—Ç—É—Ä—ã, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –∏ –∏–¥–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å —Å –±–µ–ª—ã–º–∏ –≤–∏–Ω–∞–º–∏.",
        btn_info: "–ò–ù–§–û –ò –¢–ï–•. –ö–ê–†–¢–ê",
        btn_image: "–¢–û–õ–¨–ö–û –§–û–¢–û",
        modal_label: "–¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –ö–ê–†–¢–ê –ë–õ–Æ–î–ê",
        modal_servings: "–ü–æ—Ä—Ü–∏–∏:",
        modal_prep: "–í—Ä–µ–º—è –ø—Ä–µ–ø:",
        modal_ingredients: "–ò–ù–ì–†–ï–î–ò–ï–ù–¢–´",
        modal_prep_title: "–ü–†–ò–ì–û–¢–û–í–õ–ï–ù–ò–ï",
        modal_sauce_label: "–°–æ—É—Å –∏ –û—Å–Ω–æ–≤–∞:",
        modal_equipment: "–û–ë–û–†–£–î–û–í–ê–ù–ò–ï",
        modal_cost_label: "–°–ï–ë–ï–°–¢–û–ò–ú–û–°–¢–¨",
        modal_pvp_label: "–¶–ï–ù–ê –ü–†–û–î–ê–ñ–ò",
        modal_margin_label: "–ú–ê–†–ñ–ê (–ü–†–ò–ë–´–õ–¨)",
        vibe_eyebrow: "–ê—Ç–º–æ—Å—Ñ–µ—Ä–∞",
        vibe_title: "–ë–æ–ª—å—à–µ, —á–µ–º –ø—Ä–æ—Å—Ç–æ –µ–¥–∞",
        vibe_desc: "13 Degrees ‚Äî —ç—Ç–æ –º–µ—Å—Ç–æ, –≥–¥–µ –¥—É—à–∞ –≠—Å—Ç–µ–ø–æ–Ω—ã –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è —Å –≤—ã—Å–æ–∫–æ–π –º–∏–∫—Å–æ–ª–æ–≥–∏–µ–π –∏ —è—Ä–∫–æ–π —Å–≤–µ—Ç—Å–∫–æ–π –∂–∏–∑–Ω—å—é.",
        cta_title: "–í–ê–®–ï –ú–ï–ù–Æ –ú–û–ñ–ï–¢ –ë–´–¢–¨ –¢–ê–ö–ò–ú –£–ñ–ï –ó–ê–í–¢–†–ê",
        cta_desc: "–ú—ã —Å–æ–∑–¥–∞–ª–∏ —Å–∏—Å—Ç–µ–º—É, –≥–¥–µ –ø—Ä–µ–º–∏–∞–ª—å–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç (—Ç—É–Ω–µ—Ü –∏ –ª–æ—Å–æ—Å—å) –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è —Å —É–º–Ω—ã–º–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º–∏. –ë–µ–∑ –ª–∏—à–Ω–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞. –ë–µ–∑ —Å–ø–∏—Å–∞–Ω–∏–π. –¢–æ–ª—å–∫–æ –≤–∫—É—Å –∏ –ø—Ä–∏–±—ã–ª—å.",
        cta_btn: "–û–±—Å—É–¥–∏—Ç—å –∑–∞–ø—É—Å–∫ —Å –Æ–ª–∏–µ–π",
        footer_text: "–ü–æ–ª–Ω—ã–π –ø—Ä–æ–µ–∫—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è 13 Degrees Lounge BAR.",
        view_details: "–î–ï–¢–ê–õ–ò",
        wine_pairing: "–í–∏–Ω–Ω–∞—è –ø–∞—Ä–∞:",
      },
    };

    let currentLang = "en"; // Default language

    document.addEventListener("DOMContentLoaded", () => {
      // --- Language Switching Logic ---
      const langBtns = document.querySelectorAll(".lang-btn");
      const i18nElements = document.querySelectorAll("[data-i18n]");

      // Helper to update text content with smooth fade
      const updateLanguage = (lang) => {
        if (currentLang === lang) return; // No change needed

        currentLang = lang;
        const t = translations[lang];

        // Collect all elements to animate
        const elementsToUpdate = [];

        // 1. Static Text Elements
        i18nElements.forEach((el) => elementsToUpdate.push(el));

        // 2. Dynamic Dish Cards (Titles, Desc, Pairings)
        document.querySelectorAll(".menu-card").forEach((card) => {
          const titleEl = card.nextElementSibling.querySelector(".js-dish-title");
          const descEl = card.nextElementSibling.querySelector(".js-dish-desc");
          const pairEl = card.nextElementSibling.querySelector(".js-dish-pairing");
          const overlayEl = card.querySelector('[data-i18n="view_details"]');

          if (titleEl) elementsToUpdate.push(titleEl);
          if (descEl) elementsToUpdate.push(descEl);
          if (pairEl) elementsToUpdate.push(pairEl);
          if (overlayEl) elementsToUpdate.push(overlayEl);
        });

        // Start Fade Out
        elementsToUpdate.forEach((el) => {
          el.classList.add("lang-fade");
          el.classList.add("fade-out");
        });

        // Wait for fade out, then update text and fade in
        setTimeout(() => {
          // Update Static
          i18nElements.forEach((el) => {
            const key = el.dataset.i18n;
            if (t[key]) {
              el.innerHTML = t[key];
            }
          });

          // Update Dynamic
          document.querySelectorAll(".menu-card").forEach((card) => {
            const dishKey = card.dataset.dish;
            const data = dishData[dishKey];
            if (data) {
              const titleEl = card.nextElementSibling.querySelector(".js-dish-title");
              // Use default (English) if translation missing
              const getField = (field) => (lang === "en" ? data[field] : data[`${field}_${lang}`] || data[field]);

              if (titleEl) titleEl.textContent = getField("title");

              const descEl = card.nextElementSibling.querySelector(".js-dish-desc");
              if (descEl) descEl.textContent = getField("description");

              const pairEl = card.nextElementSibling.querySelector(".js-dish-pairing");
              if (pairEl) pairEl.textContent = getField("winePairing");
            }
          });

          // Fade In
          elementsToUpdate.forEach((el) => {
            el.classList.remove("fade-out");
          });
        }, 300); // 300ms matches CSS transition

        // 3. Update active button state immediately
        langBtns.forEach((btn) => {
          btn.classList.toggle("active", btn.dataset.lang === lang);
        });
      };

      // Listeners for buttons
      langBtns.forEach((btn) => {
        btn.addEventListener("click", () => {
          const lang = btn.dataset.lang;
          updateLanguage(lang);
        });
      });

      const modal = document.getElementById("modal");
      const modalContent = document.querySelector(".modal-content");
      const modalImg = document.getElementById("modal-img");
      const modalTitle = document.getElementById("modal-title");
      const modalIngredients = document.getElementById("modal-ingredients");
      const modalSauce = document.getElementById("modal-sauce");
      const modalSteps = document.getElementById("modal-steps");
      const modalEqui = document.getElementById("modal-equi");
      const modalCost = document.getElementById("modal-cost");
      const modalPvp = document.getElementById("modal-pvp");
      const modalMargin = document.getElementById("modal-margin");

      const menuSection = document.querySelector(".menu-grid");
      const categoryBtns = document.querySelectorAll(".category-btn");

      // 1. Intersection Observer for Scroll Animations
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add("visible");
            }
          });
        },
        { threshold: 0.1 },
      );

      document.querySelectorAll(".reveal, .economic-box, .lifestyle-item").forEach((el) => {
        observer.observe(el);
      });

      // 2. Category Switching Logic
      categoryBtns.forEach((btn) => {
        btn.addEventListener("click", () => {
          const category = btn.dataset.category;

          categoryBtns.forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");

          // Animation effect
          menuSection.style.opacity = "0";
          setTimeout(() => {
            document.querySelectorAll(".menu-card").forEach((card) => {
              if (card.dataset.category === category) {
                card.style.display = "block";
              } else {
                card.style.display = "none";
              }
            });
            menuSection.style.opacity = "1";
          }, 300);
        });
      });

      // 3. Modal Logic (Event Delegation)
      menuSection.addEventListener("click", (e) => {
        const card = e.target.closest(".menu-card");
        if (!card) return;

        const dishKey = card.dataset.dish;
        const data = dishData[dishKey];

        if (data) {
          // Determine localized data based on currentLang
          const title = currentLang === "en" ? data.title : data[`title_${currentLang}`] || data.title;
          const ingredients = currentLang === "en" ? data.ingredients : data[`ingredients_${currentLang}`] || data.ingredients;
          const sauce = currentLang === "en" ? data.sauce : data[`sauce_${currentLang}`] || data.sauce;
          const steps = currentLang === "en" ? data.steps : data[`steps_${currentLang}`] || data.steps;
          const equipment = currentLang === "en" ? data.equipment : data[`equipment_${currentLang}`] || data.equipment;

          modalImg.src = data.img;
          modalTitle.textContent = title;
          modalIngredients.innerHTML = ingredients.map((i) => `<li>${i}</li>`).join("");
          modalSauce.innerHTML = sauce;
          modalSteps.innerHTML = steps.map((s) => `<li>${s}</li>`).join("");
          modalEqui.textContent = equipment;
          modalCost.textContent = data.cost;
          modalPvp.textContent = data.pvp;
          modalMargin.textContent = data.margin;

          modal.classList.add("active");
          modalContent.classList.remove("sheet-active");
          document.body.classList.add("modal-open");
        }
      });

      // 4. Modal Interactions
      const btnInfo = document.querySelector(".btn-info-trigger");
      if (btnInfo) {
        btnInfo.addEventListener("click", (e) => {
          // Prevent bubbling
          e.stopPropagation();
          modalContent.classList.add("sheet-active");
        });
      }

      // TAP IMAGE TO TOGGLE SHEET (Mobile Friendly)
      document.querySelector(".modal-image-box").addEventListener("click", (e) => {
        // Don't trigger if clicking buttons
        if (e.target.closest("button")) return;

        e.stopPropagation();
        // Toggle sheet state
        if (modalContent.classList.contains("sheet-active")) {
          modalContent.classList.remove("sheet-active");
        } else {
          modalContent.classList.add("sheet-active");
        }
      });

      const btnCloseSheet = document.querySelector(".btn-close-sheet");
      if (btnCloseSheet) {
        btnCloseSheet.addEventListener("click", (e) => {
          e.stopPropagation();
          modalContent.classList.remove("sheet-active");
        });
      }

      const closeModal = () => {
        modal.classList.remove("active");
        modalContent.classList.remove("sheet-active"); // Reset sheet
        document.body.classList.remove("modal-open");
      };

      document.querySelector(".modal-close").addEventListener("click", closeModal);
      document.querySelector(".modal-backdrop").addEventListener("click", closeModal);

      // 5. Parallax Effect
      const parallaxBg = document.querySelector(".parallax-bg");
      let scrollTimeout;
      window.addEventListener(
        "scroll",
        () => {
          if (!parallaxBg) return;
          if (!scrollTimeout) {
            window.requestAnimationFrame(() => {
              const speed = 0.5;
              const rect = parallaxBg.parentElement.getBoundingClientRect();
              const offset = window.pageYOffset - rect.top;
              parallaxBg.style.transform = `translateY(${offset * speed}px)`;
              scrollTimeout = null;
            });
            scrollTimeout = true;
          }
        },
        { passive: true },
      );

      // 6. Ambient Glow (Desktop)
      if (window.innerWidth > 1024) {
        const glow = document.createElement("div");
        glow.className = "glow-accent";
        document.body.appendChild(glow);

        let mouseTimeout;
        window.addEventListener(
          "mousemove",
          (e) => {
            if (!mouseTimeout) {
              window.requestAnimationFrame(() => {
                glow.style.left = `${e.clientX - 150}px`;
                glow.style.top = `${e.clientY - 150}px`;
                glow.style.opacity = "1";
                mouseTimeout = null;
              });
              mouseTimeout = true;
            }
          },
          { passive: true },
        );
      }
    });
  </script>
</Layout>
